# ูุธุงู ุงูุนูู Offline ูู ุงููุดุฑูุน

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุฐุง ุงููุดุฑูุน ูุฏุนู ุงูุนูู ุจุดูู ูุงูู ูู ูุถุน **Offline** (ุจุฏูู ุฅูุชุฑูุช) ุจููุณ ุงูุณุฑุนุฉ ูุงูููุงุกุฉ ูุซู ูุถุน **Online**.
ุงููุธุงู ูุตูู ููุนูู ุชููุงุฆูุงู ุฏูู ุงูุญุงุฌุฉ ูุฃู ุชุฏุฎู ูู ุงููุณุชุฎุฏู.

---

## โ ูู ุงููุธุงู ูุนูู ุจุดูู ูุงูู ูู Offlineุ

### โ **ูุนู - ุงููุธุงุฆู ุงูุฃุณุงุณูุฉ ุชุนูู**:
- โ **ุงูุจูุน**: ูููู ุจูุน ุงูููุชุฌุงุช ูุญูุธ ุงูููุงุชูุฑ ุจุดูู ูุงูู
- โ **ุชุญุฏูุซ ุงููุฎุฒูู**: ูุชู ุชุญุฏูุซ ุงููุฎุฒูู ุชููุงุฆูุงู
- โ **ุงูุทุจุงุนุฉ**: ูููู ุทุจุงุนุฉ ุงูููุงุชูุฑ
- โ **ุนุฑุถ ุฌููุน ุงูุตูุญุงุช**: ุฌููุน ุงูุตูุญุงุช ุชุนูู ูููุฑุงุกุฉ ูุงูุนุฑุถ
- โ **ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช**: ุฅุถุงูุฉ/ุชุนุฏูู/ุญุฐู ุงูููุชุฌุงุช

### โ๏ธ **ูุง - ุจุนุถ ุงููุธุงุฆู ูุง ุชุนูู ุญุงููุงู**:
- โ **ุงููุตุงุฑูู**: ูุง ูููู ุฅุถุงูุฉ/ุชุนุฏูู/ุญุฐู ูุตุฑููุงุช ูู offline
- โ **ุงููุงุฑุฏ**: ูุง ูููู ุญุฐู ูุงุฑุฏ ูู offline
- โ **ุชูููู ุงูููู**: ูุง ูููู ุชูููู ุงูููู ูู offline (ููู ูููู ุนุฑุถ ุงูุชููููุงุช ุงููุฏููุฉ)

### ๐ฏ **ุงูุฎูุงุตุฉ**:
**ุงููุธุงู ุงูุฃุณุงุณู (ุงูุจูุน) ูุนูู ุจุดูู ูุงูู ูู offline** โุ ููู ุจุนุถ ุงููุธุงุฆู ุงูุฅุถุงููุฉ ุชุญุชุงุฌ ุชุญุณููุงุช ูุฌุนู ุงููุธุงู ูุนูู 100% ูู offline.

---

## ๐ฏ ููุฑุฉ ุงููุธุงู

ุงููุธุงู ูุนูู ุนูู **ุซูุงุซุฉ ูุณุชููุงุช**:

### 1. **Firebase Offline Persistence** (ุงููุณุชูู ุงูุฃูู)
- **ุงูููู**: `app/firebase.jsx`
- **ุงููุธููุฉ**: ูุญูุธ ุฌููุน ุงูุจูุงูุงุช ุชููุงุฆูุงู ูู **IndexedDB** (ูุฎุฒู ุงููุชุตูุญ)
- **ุงููููุฒุงุช**:
  - โ ูุนูู ุชููุงุฆูุงู ูุน ุฌููุน ุนูููุงุช ุงููุฑุงุกุฉ
  - โ ุงูุจูุงูุงุช ูุชุงุญุฉ ููุฑุงู ุญุชู ุจุฏูู ุฅูุชุฑูุช
  - โ ูุง ูุญุชุงุฌ ุฃู ููุฏ ุฅุถุงูู

### 2. **Offline Queue System** (ุงููุณุชูู ุงูุซุงูู)
- **ุงูููู**: `utils/offlineQueue.js`
- **ุงููุธููุฉ**: ูุญูุธ ุฌููุน ุนูููุงุช ุงููุชุงุจุฉ (ุฅุถุงูุฉ/ุชุญุฏูุซ/ุญุฐู) ูู ูุงุฆูุฉ ุงูุชุธุงุฑ
- **ุงููููุฒุงุช**:
  - โ ูุญูุธ ุงูุนูููุงุช ูู `localStorage`
  - โ ูููุฐูุง ุชููุงุฆูุงู ุนูุฏ ุนูุฏุฉ ุงูุงุชุตุงู
  - โ ูุฏุนู ุฅุนุงุฏุฉ ุงููุญุงููุฉ (ุญุชู 5 ูุฑุงุช)

### 3. **Local Storage Cache** (ุงููุณุชูู ุงูุซุงูุซ)
- **ุงููุธููุฉ**: ูุญูุธ ุงูููุงุชูุฑ ุงููุญููุฉ ููุนุฑุถ ุงูููุฑู
- **ุงููููุฒุงุช**:
  - โ ุงูููุงุชูุฑ ุชุธูุฑ ููุฑุงู ุญุชู ูุจู ุงููุฒุงููุฉ
  - โ ูููู ุทุจุงุนุฉ ุงูููุงุชูุฑ ุญุชู ูู offline

---

## ๐ ููู ูุนูู ุงููุธุงูุ

### ุนูุฏ **Online** (ูุน ุฅูุชุฑูุช):

```
ุงููุณุชุฎุฏู ูุจูุน ููุชุฌ
    โ
ุญูุธ ุงููุงุชูุฑุฉ ูู Firebase ูุจุงุดุฑุฉ
    โ
ุชุญุฏูุซ ุงููุฎุฒูู ูู Firebase ูุจุงุดุฑุฉ
    โ
ุงูุจูุงูุงุช ุชูุญูุธ ุชููุงุฆูุงู ูู IndexedDB (ููุงุณุชุฎุฏุงู ูุงุญูุงู)
    โ
ุงููุงุชูุฑุฉ ุชุธูุฑ ููุฑุงู ูู ุงููุงุฆูุฉ
```

### ุนูุฏ **Offline** (ุจุฏูู ุฅูุชุฑูุช):

```
ุงููุณุชุฎุฏู ูุจูุน ููุชุฌ
    โ
ุญูุธ ุงููุงุชูุฑุฉ ูู localStorage (offlineInvoices)
    โ
ุฅุถุงูุฉ ุงูุนูููุฉ ููุงุฆูุฉ ุงูุงูุชุธุงุฑ (offlineQueue)
    โ
ุชุญุฏูุซ ุงููุฎุฒูู ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ
    โ
ุงููุงุชูุฑุฉ ุชุธูุฑ ููุฑุงู ูู ุงููุงุฆูุฉ (ูู localStorage)
    โ
ุนูุฏ ุนูุฏุฉ ุงูุงุชุตุงู โ ุงููุฒุงููุฉ ุงูุชููุงุฆูุฉ
```

---

## ๐ฆ ุฃูู ุชูุฎุฒู ุงูุจูุงูุงุชุ

### 1. **ุงูููุงุชูุฑ ุงููุญููุฉ (Offline Invoices)**
- **ุงูููุงู**: `localStorage` โ ููุชุงุญ `offlineInvoices`
- **ุงูุดูู**: Array of objects
- **ุงูุงุณุชุฎุฏุงู**: ููุนุฑุถ ุงูููุฑู ูุงูุทุจุงุนุฉ

**ูุซุงู ุนูู ุงูุจูุงูุงุช:**
```json
[
  {
    "id": "offline-1234567890-abc123",
    "invoiceNumber": 123,
    "cart": [...],
    "clientName": "ุฃุญูุฏ ูุญูุฏ",
    "phone": "01234567890",
    "date": "2024-01-15T10:30:00.000Z",
    "shop": "shop1",
    "total": 500,
    "profit": 100,
    "employee": "ูุญูุฏ",
    "discount": 0
  }
]
```

### 2. **ูุงุฆูุฉ ุงูุงูุชุธุงุฑ (Offline Queue)**
- **ุงูููุงู**: `localStorage` โ ููุชุงุญ `offlineQueue`
- **ุงูุดูู**: Array of operations
- **ุงูุงุณุชุฎุฏุงู**: ูููุฒุงููุฉ ูุน Firebase ุนูุฏ ุนูุฏุฉ ุงูุงุชุตุงู

**ูุซุงู ุนูู ุงูุจูุงูุงุช:**
```json
[
  {
    "id": "offline-1234567890-xyz789",
    "collectionName": "dailySales",
    "action": "add",
    "data": { ... },
    "timestamp": "2024-01-15T10:30:00.000Z",
    "synced": false,
    "retries": 0
  },
  {
    "id": "offline-1234567891-abc456",
    "collectionName": "lacosteProducts",
    "action": "update",
    "docId": "product123",
    "data": { "quantity": 10 },
    "timestamp": "2024-01-15T10:30:05.000Z",
    "synced": false,
    "retries": 0
  }
]
```

### 3. **IndexedDB (Firebase Cache)**
- **ุงูููุงู**: IndexedDB ูู ุงููุชุตูุญ
- **ุงููุธููุฉ**: ูุญูุธ ุฌููุน ุงูุจูุงูุงุช ูู Firebase ุชููุงุฆูุงู
- **ุงููุตูู**: ุนุจุฑ Firebase SDK (ุชููุงุฆู)

---

## ๐ ููููุฉ ุงููุตูู ููุจูุงูุงุช ุงููุญููุฉ

### 1. **ุนุจุฑ Console ุงููุชุตูุญ (Developer Tools)**

ุงูุชุญ **Developer Tools** (F12) ุซู ูู **Console**:

```javascript
// ุนุฑุถ ุฌููุน ุงูููุงุชูุฑ ุงููุญููุฉ
const offlineInvoices = JSON.parse(localStorage.getItem("offlineInvoices") || "[]");
console.log("ุงูููุงุชูุฑ ุงููุญููุฉ:", offlineInvoices);

// ุนุฑุถ ูุงุฆูุฉ ุงูุงูุชุธุงุฑ
const offlineQueue = JSON.parse(localStorage.getItem("offlineQueue") || "[]");
console.log("ูุงุฆูุฉ ุงูุงูุชุธุงุฑ:", offlineQueue);

// ุนุฑุถ ุนุฏุฏ ุงูููุงุชูุฑ ุงููุญููุฉ
const invoiceCount = offlineInvoices.length;
console.log(`ุนุฏุฏ ุงูููุงุชูุฑ ุงููุญููุฉ: ${invoiceCount}`);

// ุนุฑุถ ุนุฏุฏ ุงูุนูููุงุช ุงููุนููุฉ
const pendingCount = offlineQueue.filter(op => !op.synced).length;
console.log(`ุนุฏุฏ ุงูุนูููุงุช ุงููุนููุฉ: ${pendingCount}`);
```

### 2. **ุนุจุฑ Application Tab ูู Developer Tools**

1. ุงูุชุญ **Developer Tools** (F12)
2. ุงุฐูุจ ุฅูู ุชุจููุจ **Application** (ุฃู **Storage** ูู Firefox)
3. ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉุ ุงุฎุชุฑ **Local Storage**
4. ุงุฎุชุฑ ูููุน ุงููุดุฑูุน (`http://localhost:3000`)
5. ุณุชุฌุฏ ุงูููุงุชูุญ ุงูุชุงููุฉ:
   - `offlineInvoices` - ุงูููุงุชูุฑ ุงููุญููุฉ
   - `offlineQueue` - ูุงุฆูุฉ ุงูุงูุชุธุงุฑ
   - `lastInvoiceNumber` - ุขุฎุฑ ุฑูู ูุงุชูุฑุฉ
   - `suspendedInvoices` - ุงูููุงุชูุฑ ุงููุนููุฉ

---

## ๐๏ธ ููููุฉ ุญุฐู ุจูุนุฉ ูุณุฌูุฉ

### ุงูุทุฑููุฉ 1: ุญุฐู ูุงุชูุฑุฉ ูุญุฏุฏุฉ ูู ุงูููุงุชูุฑ ุงููุญููุฉ

```javascript
// ูู Console ุงููุชุตูุญ (F12)

// 1. ุฌูุจ ุฌููุน ุงูููุงุชูุฑ ุงููุญููุฉ
const offlineInvoices = JSON.parse(localStorage.getItem("offlineInvoices") || "[]");

// 2. ุนุฑุถ ุงูููุงุชูุฑ ูุงุฎุชูุงุฑ ุงููุงุชูุฑุฉ ุงููุฑุงุฏ ุญุฐููุง
console.table(offlineInvoices.map(inv => ({
  id: inv.id,
  invoiceNumber: inv.invoiceNumber,
  clientName: inv.clientName,
  total: inv.total,
  date: inv.date
})));

// 3. ุญุฐู ูุงุชูุฑุฉ ุจุฑูู ูุนูู (ูุซูุงู ุฑูู 123)
const invoiceNumberToDelete = 123;
const filtered = offlineInvoices.filter(inv => inv.invoiceNumber !== invoiceNumberToDelete);

// 4. ุญูุธ ุงููุงุฆูุฉ ุงููุญุฏุซุฉ
localStorage.setItem("offlineInvoices", JSON.stringify(filtered));

console.log(`ุชู ุญุฐู ุงููุงุชูุฑุฉ ุฑูู ${invoiceNumberToDelete}`);
```

### ุงูุทุฑููุฉ 2: ุญุฐู ูุงุชูุฑุฉ ุจุงูู ID

```javascript
// ุญุฐู ูุงุชูุฑุฉ ุจุงูู ID ุงููุญุฏุฏ
const invoiceIdToDelete = "offline-1234567890-abc123";
const offlineInvoices = JSON.parse(localStorage.getItem("offlineInvoices") || "[]");
const filtered = offlineInvoices.filter(inv => inv.id !== invoiceIdToDelete);
localStorage.setItem("offlineInvoices", JSON.stringify(filtered));
console.log("ุชู ุงูุญุฐู ุจูุฌุงุญ");
```

### ุงูุทุฑููุฉ 3: ุญุฐู ุฌููุน ุงูููุงุชูุฑ ุงููุญููุฉ

```javascript
// โ๏ธ ุชุญุฐูุฑ: ูุฐุง ุณูุญุฐู ุฌููุน ุงูููุงุชูุฑ ุงููุญููุฉ
localStorage.removeItem("offlineInvoices");
console.log("ุชู ุญุฐู ุฌููุน ุงูููุงุชูุฑ ุงููุญููุฉ");
```

### ุงูุทุฑููุฉ 4: ุญุฐู ุนูููุฉ ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ

```javascript
// ุญุฐู ุนูููุฉ ูุญุฏุฏุฉ ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ
const queueIdToDelete = "offline-1234567890-xyz789";
const offlineQueue = JSON.parse(localStorage.getItem("offlineQueue") || "[]");
const filtered = offlineQueue.filter(op => op.id !== queueIdToDelete);
localStorage.setItem("offlineQueue", JSON.stringify(filtered));
console.log("ุชู ุญุฐู ุงูุนูููุฉ ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ");
```

### ุงูุทุฑููุฉ 5: ูุณุญ ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ุจุงููุงูู

```javascript
// โ๏ธ ุชุญุฐูุฑ: ูุฐุง ุณูุญุฐู ุฌููุน ุงูุนูููุงุช ุงููุนููุฉ
localStorage.removeItem("offlineQueue");
console.log("ุชู ูุณุญ ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ุจุงููุงูู");
```

---

## โ ูุง ูุนูู ูู Offline ุญุงููุงู

### 1. **ุงูุจูุน (ุงููุจูุนุงุช)**
- โ **ูุนูู ุจุดูู ูุงูู**: ูููู ุงูุจูุน ูุญูุธ ุงูููุงุชูุฑ ูู offline
- โ **ุชุญุฏูุซ ุงููุฎุฒูู**: ูุชู ุชุญุฏูุซ ุงููุฎุฒูู ุชููุงุฆูุงู ุญุชู ูู offline
- โ **ุงูุทุจุงุนุฉ**: ูููู ุทุจุงุนุฉ ุงูููุงุชูุฑ ุญุชู ูู offline
- โ **ุงูุนุฑุถ**: ุงูููุงุชูุฑ ุชุธูุฑ ููุฑุงู ูู ุงููุงุฆูุฉ

### 2. **ุนุฑุถ ุงูุจูุงูุงุช**
- โ **ุงูููุงุชูุฑ**: ุชุนูู ูู cache (IndexedDB)
- โ **ุงูููุชุฌุงุช**: ุชุนูู ูู cache
- โ **ุงูุชููููุงุช**: ุชุนูู ูู cache (ูููุฑุงุกุฉ ููุท)
- โ **ุงูุชูุงุฑูุฑ**: ุชุนูู ูู cache

### 3. **ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช**
- โ **ุฅุถุงูุฉ ููุชุฌุงุช**: ุชุนูู ูู offline (ูุชู ุงููุฒุงููุฉ ูุงุญูุงู)
- โ **ุชุญุฏูุซ ููุชุฌุงุช**: ุชุนูู ูู offline
- โ **ุญุฐู ููุชุฌุงุช**: ูุนูู ูู offline

---

## โ ูุง ูุง ูุนูู ูู Offline ุญุงููุงู

### 1. **ุงููุตุงุฑูู (Masrofat)**
- โ **ุฅุถุงูุฉ ูุตุฑูู**: ูุง ูุนูู ูู offline (ูุณุชุฎุฏู `addDoc` ูุจุงุดุฑุฉ)
- โ **ุชุญุฏูุซ ูุตุฑูู**: ูุง ูุนูู ูู offline (ูุณุชุฎุฏู `updateDoc` ูุจุงุดุฑุฉ)
- โ **ุญุฐู ูุตุฑูู**: ูุง ูุนูู ูู offline (ูุณุชุฎุฏู `deleteDoc` ูุจุงุดุฑุฉ)
- **ุงูุณุจุจ**: ุงูุตูุญุฉ ูุง ุชุณุชุฎุฏู `offlineAdd`, `offlineUpdate`, `offlineDelete`
- **ุงูุชุฃุซูุฑ**: ุนูุฏ ุฅุถุงูุฉ/ุชุนุฏูู/ุญุฐู ูุตุฑูู ูู offlineุ ุณุชูุดู ุงูุนูููุฉ

### 2. **ุงููุงุฑุฏ (Wared)**
- โ **ุญุฐู ูุงุฑุฏ**: ูุง ูุนูู ูู offline (ูุณุชุฎุฏู `deleteDoc` ูุจุงุดุฑุฉ)
- **ุงูุณุจุจ**: ุงูุตูุญุฉ ูุง ุชุณุชุฎุฏู `offlineDelete`
- **ุงูุชุฃุซูุฑ**: ุนูุฏ ุญุฐู ูุงุฑุฏ ูู offlineุ ุณุชูุดู ุงูุนูููุฉ

### 3. **ุชูููู ุงูููู**
- โ **ุชูููู ุงูููู**: ูุง ูุนูู ูู offline
- **ุงูุณุจุจ**: ูุณุชุฎุฏู `getDocs` ู `writeBatch` ูุจุงุดุฑุฉ ุจุฏูู ุฏุนู offline
- **ุงูุชุฃุซูุฑ**: ูุง ูููู ุชูููู ุงูููู ูู offline
- **ููุงุญุธุฉ**: ูููู **ุนุฑุถ** ุงูุชููููุงุช ุงููุฏููุฉ ูู cache

### 4. **ุนูููุงุช ุฃุฎุฑู**
- โ **ุจุนุถ ุงูุตูุญุงุช**: ูุฏ ูุง ุชุนูู ุจุดูู ูุงูู ูู offline
- **ุงูุชุฃุซูุฑ**: ูุฏ ุชูุงุฌู ุฃุฎุทุงุก ุนูุฏ ุงุณุชุฎุฏุงู ุจุนุถ ุงููุธุงุฆู ูู offline

---

## โ๏ธ ุงููุดุงูู ุงูููุฌูุฏุฉ ุญุงููุงู

### 1. **ูุดููุฉ ุงูุชูุฑุงุฑ ูู ุงูููุงุชูุฑ**
- **ุงููุตู**: ูุฏ ุชุธูุฑ ุงููุงุชูุฑุฉ ูุฑุชูู (ูุฑุฉ ูู Firebase ููุฑุฉ ูู localStorage)
- **ุงูุณุจุจ**: ุนูุฏ ุงููุฒุงููุฉุ ูุฏ ูุง ูุชู ุญุฐู ุงููุงุชูุฑุฉ ูู localStorage ููุฑุงู
- **ุงูุญู ุงูุญุงูู**: ุงููุธุงู ูุญุงูู ุฅุฒุงูุฉ ุงูุชูุฑุงุฑุงุช ุชููุงุฆูุงู

### 2. **ูุดููุฉ ุฑูู ุงููุงุชูุฑุฉ**
- **ุงููุตู**: ูุฏ ุชุชูุฑุฑ ุฃุฑูุงู ุงูููุงุชูุฑ ุฅุฐุง ุชู ุงูุจูุน ูู ุนุฏุฉ ุฃุฌูุฒุฉ offline
- **ุงูุณุจุจ**: ูู ุฌูุงุฒ ูุณุชุฎุฏู localStorage ูุญูู
- **ุงูุญู ุงูุญุงูู**: ูุชู ุงููุฒุงููุฉ ูุน Firebase ุนูุฏ ุนูุฏุฉ ุงูุงุชุตุงู

### 3. **ูุดููุฉ ุญุฌู localStorage**
- **ุงููุตู**: localStorage ูุญุฏูุฏ ุจุญูุงูู 5-10 MB
- **ุงูุณุจุจ**: ูุฏ ุชูุชูุฆ ุฅุฐุง ูุงูุช ููุงู ููุงุชูุฑ ูุซูุฑุฉ
- **ุงูุญู ุงูููุตู ุจู**: ุญุฐู ุงูููุงุชูุฑ ุงููุญููุฉ ุจุนุฏ ุงููุฒุงููุฉ ุงููุงุฌุญุฉ

### 4. **ูุดููุฉ ุงููุตุงุฑูู ูุงููุงุฑุฏ**
- **ุงููุตู**: ูุง ูููู ุฅุถุงูุฉ/ุชุนุฏูู/ุญุฐู ูุตุฑููุงุช ุฃู ูุงุฑุฏ ูู offline
- **ุงูุณุจุจ**: ุงูุตูุญุงุช ูุง ุชุณุชุฎุฏู ุฏูุงู offline
- **ุงูุชุฃุซูุฑ**: ูุฌุจ ุงูุงูุชุธุงุฑ ุญุชู ุนูุฏุฉ ุงูุงุชุตุงู

---

## ๐ ุงูุชุญุณููุงุช ุงููุทููุจุฉ ูุฌุนู ุงููุธุงู ูุนูู ุจุดูู ูุงูู ูู Offline

### 1. **ุฅุถุงูุฉ ุฏุนู Offline ูููุตุงุฑูู (Masrofat)** โ๏ธ **ููู ุฌุฏุงู**

**ุงูููู**: `app/masrofat/page.jsx`

**ุงูุชุนุฏููุงุช ุงููุทููุจุฉ**:
```javascript
// ุงุณุชุจุฏุงู addDoc ุจู offlineAdd
import { offlineAdd, offlineUpdate, offlineDelete } from "@/utils/firebaseOffline";

// ูู handleAddMasrof
const result = await offlineAdd("masrofat", masrofData);
if (result.offline) {
  // ุญูุธ ูุญูู ููุนุฑุถ ุงูููุฑู
}

// ูู handleUpdateMasrof
await offlineUpdate("masrofat", editingMasrof.id, updatedData);

// ูู handleDeleteMasrof
await offlineDelete("masrofat", masrofId);
```

### 2. **ุฅุถุงูุฉ ุฏุนู Offline ูููุงุฑุฏ (Wared)** โ๏ธ **ููู**

**ุงูููู**: `app/wared/page.jsx`

**ุงูุชุนุฏููุงุช ุงููุทููุจุฉ**:
```javascript
import { offlineDelete } from "@/utils/firebaseOffline";

// ูู confirmDeleteSelected ู confirmDeleteSingle
await offlineDelete("wared", id);
```

### 3. **ุฅุถุงูุฉ ุฏุนู Offline ูุชูููู ุงูููู** โ๏ธ **ููู ุฌุฏุงู**

**ุงูููู**: `components/Main/services/closeDayService.js`

**ุงูุชุญุฏู**: ุชูููู ุงูููู ูุญุชุงุฌ ูุฑุงุกุฉ ุฌููุน ุงูุจูุงูุงุช ุฃููุงูุ ุซู ูุชุงุจุฉ ุนุฏุฉ ุนูููุงุช

**ุงูุญู ุงูููุชุฑุญ**:
- ุญูุธ ุงูุชููููุฉ ูุญููุงู ูู localStorage
- ุฅุถุงูุฉ ูููุงุฆูุฉ ูููุฒุงููุฉ
- ุนุฑุถ ุงูุชููููุงุช ุงููุญููุฉ ุญุชู ูุจู ุงููุฒุงููุฉ

### 4. **ุญุฐู ุชููุงุฆู ููููุงุชูุฑ ุงููุญููุฉ ุจุนุฏ ุงููุฒุงููุฉ**

```javascript
// ูู utils/offlineQueue.js ุจุนุฏ ูุฌุงุญ ุงููุฒุงููุฉ
// ุฅุถุงูุฉ ููุฏ ูุญุฐู ุงููุงุชูุฑุฉ ูู offlineInvoices ุจุนุฏ ุงููุฒุงููุฉ ุงููุงุฌุญุฉ
```

### 5. **ุชุญุณูู ุฑูู ุงููุงุชูุฑุฉ**

```javascript
// ุงุณุชุฎุฏุงู UUID ุฃู timestamp + random ููู ID
// ุจุฏูุงู ูู ุงูุงุนุชูุงุฏ ุนูู ุฑูู ูุชุณูุณู
```

### 6. **ุฅุถุงูุฉ ูุงุฌูุฉ ูุฅุฏุงุฑุฉ ุงูููุงุชูุฑ ุงููุญููุฉ**

```javascript
// ุฅูุดุงุก ุตูุญุฉ ูู ุงููุดุฑูุน ูุนุฑุถ ูุญุฐู ุงูููุงุชูุฑ ุงููุญููุฉ
// app/offline-invoices/page.jsx
```

### 7. **ุชุญุณูู ุญุฌู ุงูุจูุงูุงุช**

```javascript
// ุถุบุท ุงูุจูุงูุงุช ูุจู ุงูุญูุธ ูู localStorage
// ุฃู ุงุณุชุฎุฏุงู IndexedDB ุจุฏูุงู ูู localStorage ููุจูุงูุงุช ุงููุจูุฑุฉ
```

### 8. **ุฅุถุงูุฉ ุชุญุฐูุฑ ุนูุฏ ุงูุชูุงุก localStorage**

```javascript
// ูุญุต ุญุฌู localStorage ูุฅุธูุงุฑ ุชุญุฐูุฑ ุนูุฏ ุงูุงูุชุฑุงุจ ูู ุงูุญุฏ ุงูุฃูุตู
```

---

## ๐ ุงููููุงุช ุงูุฑุฆูุณูุฉ ูู ุงููุธุงู

### 1. **Firebase Configuration**
- `app/firebase.jsx` - ุฅุนุฏุงุฏ Firebase ูุน Offline Persistence

### 2. **Offline Queue System**
- `utils/offlineQueue.js` - ูุธุงู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ
- `utils/firebaseOffline.js` - ุฏูุงู wrapper ููุนูููุงุช

### 3. **Services**
- `components/Main/services/invoiceService.js` - ุฎุฏูุฉ ุงูููุงุชูุฑ
- `components/Main/services/stockService.js` - ุฎุฏูุฉ ุงููุฎุฒูู

### 4. **Hooks**
- `hooks/useOfflineSync.js` - Hook ูููุฒุงููุฉ ุงูุชููุงุฆูุฉ
- `hooks/useInvoices.js` - Hook ูุนุฑุถ ุงูููุงุชูุฑ (ูุฏุนู offline)

### 5. **Documentation**
- `docs/OFFLINE_USAGE.md` - ุฏููู ุงูุงุณุชุฎุฏุงู ุงูุฃุณุงุณู
- `docs/OFFLINE_SYSTEM.md` - ูุฐุง ุงูููู (ุดุฑุญ ุชูุตููู)

---

## ๐ง ุฃูุซูุฉ ุนูููุฉ

### ูุซุงู 1: ูุญุต ุญุงูุฉ ุงููุธุงู

```javascript
// ูู Console ุงููุชุตูุญ
const checkOfflineStatus = () => {
  const offlineInvoices = JSON.parse(localStorage.getItem("offlineInvoices") || "[]");
  const offlineQueue = JSON.parse(localStorage.getItem("offlineQueue") || "[]");
  const pendingOps = offlineQueue.filter(op => !op.synced);
  
  console.log("=== ุญุงูุฉ ุงููุธุงู Offline ===");
  console.log(`ุนุฏุฏ ุงูููุงุชูุฑ ุงููุญููุฉ: ${offlineInvoices.length}`);
  console.log(`ุนุฏุฏ ุงูุนูููุงุช ุงููุนููุฉ: ${pendingOps.length}`);
  console.log(`ุญุงูุฉ ุงูุงุชุตุงู: ${navigator.onLine ? "Online" : "Offline"}`);
  
  if (pendingOps.length > 0) {
    console.log("\nุงูุนูููุงุช ุงููุนููุฉ:");
    pendingOps.forEach(op => {
      console.log(`- ${op.action} ุนูู ${op.collectionName} (ID: ${op.id})`);
    });
  }
};

checkOfflineStatus();
```

### ูุซุงู 2: ุชุตุฏูุฑ ุงูููุงุชูุฑ ุงููุญููุฉ

```javascript
// ุชุตุฏูุฑ ุงูููุงุชูุฑ ุงููุญููุฉ ูููู JSON
const exportOfflineInvoices = () => {
  const offlineInvoices = JSON.parse(localStorage.getItem("offlineInvoices") || "[]");
  const dataStr = JSON.stringify(offlineInvoices, null, 2);
  const dataBlob = new Blob([dataStr], { type: "application/json" });
  const url = URL.createObjectURL(dataBlob);
  const link = document.createElement("a");
  link.href = url;
  link.download = `offline-invoices-${new Date().toISOString()}.json`;
  link.click();
  console.log("ุชู ุชุตุฏูุฑ ุงูููุงุชูุฑ ุงููุญููุฉ");
};

exportOfflineInvoices();
```

### ูุซุงู 3: ุงุณุชูุฑุงุฏ ููุงุชูุฑ ูุญููุฉ

```javascript
// โ๏ธ ุงุญุฐุฑ: ูุฐุง ุณูุณุชุจุฏู ุงูููุงุชูุฑ ุงููุญููุฉ ุงูุญุงููุฉ
const importOfflineInvoices = (jsonData) => {
  try {
    const invoices = JSON.parse(jsonData);
    localStorage.setItem("offlineInvoices", JSON.stringify(invoices));
    console.log(`ุชู ุงุณุชูุฑุงุฏ ${invoices.length} ูุงุชูุฑุฉ`);
    // ุชุญุฏูุซ ุงููุงุฆูุฉ
    window.dispatchEvent(new Event("offlineInvoiceAdded"));
  } catch (error) {
    console.error("ุฎุทุฃ ูู ุงูุงุณุชูุฑุงุฏ:", error);
  }
};
```

---

## ๐ ูุตุงุฆุญ ูููุฉ

1. **ุงุญุฐู ุงูููุงุชูุฑ ุงููุญููุฉ ุจุนุฏ ุงููุฒุงููุฉ ุงููุงุฌุญุฉ** ูุชูููุฑ ูุณุงุญุฉ
2. **ุฑุงูุจ ุญุฌู localStorage** ูุชุฌูุจ ุงูุชูุงุก ุงููุณุงุญุฉ
3. **ุงุญุชูุธ ุจูุณุฎุฉ ุงุญุชูุงุทูุฉ** ูู ุงูููุงุชูุฑ ุงููููุฉ ูุจู ุงูุญุฐู
4. **ุงุณุชุฎุฏู Console ุงููุชุตูุญ** ูููุญุต ูุงูุชุตุญูุญ
5. **ุฑุงูุจ ูุงุฆูุฉ ุงูุงูุชุธุงุฑ** ููุชุฃูุฏ ูู ูุฌุงุญ ุงููุฒุงููุฉ

---

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:
1. ุงูุชุญ **Console** (F12) ูุงุจุญุซ ุนู ุงูุฃุฎุทุงุก
2. ุชุญูู ูู ุญุงูุฉ **localStorage** ูู **Application** tab
3. ุฑุงุฌุน ููู `docs/OFFLINE_USAGE.md` ููุงุณุชุฎุฏุงู ุงูุฃุณุงุณู

---

---

## ๐ ููุฎุต: ูู ุงููุธุงู ูุนูู ุจุดูู ูุงูู ูู Offlineุ

### โ **ูุนู - ูุนูู ุจุดูู ูุงูู**:
1. โ **ุงูุจูุน**: ุจูุน ุงูููุชุฌุงุช ูุญูุธ ุงูููุงุชูุฑ
2. โ **ุชุญุฏูุซ ุงููุฎุฒูู**: ุชุญุฏูุซ ุชููุงุฆู ูููุฎุฒูู
3. โ **ุงูุทุจุงุนุฉ**: ุทุจุงุนุฉ ุงูููุงุชูุฑ
4. โ **ุนุฑุถ ุงูุจูุงูุงุช**: ุฌููุน ุงูุตูุญุงุช ุชุนูู ูููุฑุงุกุฉ
5. โ **ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช**: ุฅุถุงูุฉ/ุชุนุฏูู/ุญุฐู ุงูููุชุฌุงุช

### โ **ูุง - ูุง ูุนูู ุญุงููุงู**:
1. โ **ุงููุตุงุฑูู**: ุฅุถุงูุฉ/ุชุนุฏูู/ุญุฐู ุงููุตุงุฑูู
2. โ **ุงููุงุฑุฏ**: ุญุฐู ูุงุฑุฏ
3. โ **ุชูููู ุงูููู**: ุชูููู ุงูููู (ููู ูููู ุนุฑุถ ุงูุชููููุงุช ุงููุฏููุฉ)

### ๐ฏ **ุงูุฎูุงุตุฉ**:
- **ุงููุธุงู ุงูุฃุณุงุณู (ุงูุจูุน)**: โ ูุนูู ุจุดูู ูุงูู ูู offline
- **ุงููุธุงุฆู ุงูุฅุถุงููุฉ**: โ๏ธ ุจุนุถูุง ูุง ูุนูู ููุญุชุงุฌ ุชุญุณููุงุช
- **ุงูุชูุตูุฉ**: ุฅุถุงูุฉ ุฏุนู offline ูููุตุงุฑูู ูุงููุงุฑุฏ ูุชูููู ุงูููู ูุฌุนู ุงููุธุงู ูุนูู ุจุดูู ูุงูู

---

**ุขุฎุฑ ุชุญุฏูุซ**: 2024
**ุงูุฅุตุฏุงุฑ**: 2.0

